import{d as p,r as f,o as _,c as g,e as v,t as y,u as S,i as h,j as N,f as O}from"./index-2987a531.js";import{p as o,r as J}from"./pb-3e7cd295.js";const R=p({__name:"Redirect",setup(w){const a=f({}),l=S(),m=h(),r=l.query,d=N(),t=JSON.parse(localStorage.getItem("provider"));return _(async()=>{}),t.state!==r.state&&console.log("State parameters don't match. provider.state: "+t.state+" route.state: "+r.state),o.collection("users").authWithOAuth2(t.name,r.code,t.codeVerifier,J,{emailVisibility:!1}).then(async e=>{var s,i,c,n;a.value=JSON.stringify(e,null,2),d.commit("login",e);try{await o.collection("team").getFirstListItem(`discord_id="${(s=e.meta)==null?void 0:s.id}"`,{})}catch{const u={name:(i=e.meta)==null?void 0:i.name,avatar:(c=e.meta)==null?void 0:c.avatarUrl,discord_id:(n=e.meta)==null?void 0:n.id.toString(),steam_ids:JSON.stringify([]),lol_ids:JSON.stringify([])};await o.collection("team").create(u)}await m.push({name:"home",params:{successful:"true"}})}).catch(e=>{a.value=`Failed to exchange code.
`+e}),(e,s)=>(O(),g("div",null,[v("pre",null,y(a.value),1)]))}});export{R as default};
